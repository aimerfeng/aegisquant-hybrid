<Window x:Class="AegisQuant.UI.Views.AuditLogWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:services="clr-namespace:AegisQuant.UI.Services"
        mc:Ignorable="d"
        Title="审计日志" Height="600" Width="900"
        WindowStartupLocation="CenterOwner">
    
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 筛选面板 -->
        <Border Grid.Row="0" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="开始时间:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <DatePicker Grid.Column="1" x:Name="StartDatePicker" SelectedDate="{Binding StartDate}" Margin="0,0,16,0"/>
                
                <TextBlock Grid.Column="2" Text="结束时间:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <DatePicker Grid.Column="3" x:Name="EndDatePicker" SelectedDate="{Binding EndDate}" Margin="0,0,16,0"/>
                
                <TextBlock Grid.Column="4" Text="操作类型:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <ComboBox Grid.Column="5" x:Name="ActionTypeFilter" Width="120" Margin="0,0,16,0"
                          SelectionChanged="ActionTypeFilter_SelectionChanged">
                    <ComboBoxItem Content="全部" Tag="" IsSelected="True"/>
                    <ComboBoxItem Content="按钮点击" Tag="ButtonClick"/>
                    <ComboBoxItem Content="参数修改" Tag="ParameterChange"/>
                    <ComboBoxItem Content="环境切换" Tag="EnvironmentChange"/>
                    <ComboBoxItem Content="登录" Tag="Login"/>
                    <ComboBoxItem Content="登出" Tag="Logout"/>
                    <ComboBoxItem Content="订单操作" Tag="OrderAction"/>
                    <ComboBoxItem Content="紧急停止" Tag="EmergencyStop"/>
                    <ComboBoxItem Content="回测启动" Tag="BacktestStart"/>
                    <ComboBoxItem Content="回测停止" Tag="BacktestStop"/>
                </ComboBox>
                
                <Button Grid.Column="6" Content="查询" Click="SearchButton_Click" Padding="16,4"/>
            </Grid>
        </Border>
        
        <!-- 日志列表 -->
        <DataGrid Grid.Row="1" x:Name="LogDataGrid" 
                  AutoGenerateColumns="False" 
                  IsReadOnly="True"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Single"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  BorderBrush="#DDD"
                  BorderThickness="1">
            <DataGrid.Columns>
                <DataGridTextColumn Header="时间" Binding="{Binding FormattedTimestamp}" Width="160"/>
                <DataGridTextColumn Header="用户" Binding="{Binding Username}" Width="100"/>
                <DataGridTextColumn Header="操作类型" Binding="{Binding ActionTypeDisplay}" Width="100"/>
                <DataGridTextColumn Header="详情" Binding="{Binding Details}" Width="*"/>
                <DataGridTextColumn Header="旧值" Binding="{Binding OldValue}" Width="100"/>
                <DataGridTextColumn Header="新值" Binding="{Binding NewValue}" Width="100"/>
            </DataGrid.Columns>
            
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding ActionType}" Value="EmergencyStop">
                            <Setter Property="Background" Value="#FFEEEE"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding ActionType}" Value="Login">
                            <Setter Property="Background" Value="#EEFFEE"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding ActionType}" Value="EnvironmentChange">
                            <Setter Property="Background" Value="#FFFFEE"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>
        
        <!-- 底部按钮 -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <TextBlock x:Name="RecordCountText" Text="共 0 条记录" VerticalAlignment="Center" Margin="0,0,16,0"/>
            <Button Content="导出 JSON" Click="ExportJsonButton_Click" Padding="16,4" Margin="0,0,8,0"/>
            <Button Content="导出 CSV" Click="ExportCsvButton_Click" Padding="16,4" Margin="0,0,8,0"/>
            <Button Content="刷新" Click="RefreshButton_Click" Padding="16,4" Margin="0,0,8,0"/>
            <Button Content="关闭" Click="CloseButton_Click" Padding="16,4"/>
        </StackPanel>
    </Grid>
</Window>
